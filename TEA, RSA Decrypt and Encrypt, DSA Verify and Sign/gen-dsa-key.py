#PROYECTO 1 LAURA HENRIQUEZ CAZORLA
#PARTE 3

#PROGRAMA gen-dsa-key.py

import random
import sys

#tomamos los valores de N,L,p,q,g que nos da el ejercico
(N, L) = (32, 256)
#f= SHA2-256
q=76059926100834997168886959259974740827583969659752342540152905438681210714437
p=26637745837864131290700910256631620935532246474050686527637391468419091311421880145341862249503983175226708703703661735488742213383465030982895875788926645847543100936984964689552401143720365660806586261622312208209907802788353335550988113329377762056962777935038202695984437718796564028377524795121411128417239049880037897623625218684231069376604983923311880338650116426101686882634583273617073415070596281127783708350617705699955850411723129046709467644647263001426990578838799951132559449076256833633442682618016711044060862782705884649094038765533134537498873864962695295894049714523337586163138984368317828966377
g=13869781642129328376115686255757519025046394720817076227369621463598519136790821512770014943841063097415311879198490263181852759477735694879381610155969968840949577003778703127777570458151324186361219048645563382596013367328431343101155121233664253327838139853881054095249017718738765124290784493127045821543970487420997108733819204592024289844334636828827355786525240165121735815210025381271825673037154876405881573754092854510881817887156574277603772501530315831851738630813076998681026785327941353650544285716176876336878500064480503856129699028778883619035073700877640807263793990172844221585041178137680800871102
 
#función principal del programa que nos genera una clave dsa
def gen_dsa_key(dsa_skey_file,dsa_pkey_file):
    #tomamos un valor random entre 1 y q-1
    x=random.randint(1,q-1)
    #obtenemos y a a partir de x
    y = pow(g, x, p)
    #obtenemos los bytes de x,y, y de sus longitudes
    len_x = (x.bit_length() + 7) // 8
    x=x.to_bytes(len_x, byteorder='big')
    len_x= len_x.to_bytes(2, byteorder='big')
    len_y = (y.bit_length() + 7) // 8
    y=y.to_bytes(len_y, byteorder='big')
    len_y= len_y.to_bytes(2, byteorder='big')
    # en la secret key va x
    with open(dsa_skey_file,'wb') as skey:
        skey.write(b"crip23\x05")
        skey.write(len_x)
        skey.write(x)
    #en la public key va y
    with open(dsa_pkey_file,'wb') as pkey:
        pkey.write(b"crip23\x06")
        pkey.write(len_y)
        pkey.write(y)
        

#La función main() se ejecuta cuando el programa se inicia 
def main():
    # dsa_skey_file = "martin.dsa.sk"
    # dsa_pkey_file = "martin.dsa.pk"
    dsa_skey_file = sys.argv[1]
    dsa_pkey_file = sys.argv[2]

     #Llamamos a la función que nos crea una dsa key
    gen_dsa_key(dsa_skey_file, dsa_pkey_file)

if __name__ == "__main__":
    main()
